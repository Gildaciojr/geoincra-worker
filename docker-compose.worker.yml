services:
  geoincra_worker:
    build: .
    container_name: geoincra_worker
    restart: always

    environment:
      PYTHONUNBUFFERED: "1"   # ‚úÖ OBRIGAT√ìRIO (logs em tempo real)
      # =========================
      # DATABASE
      # =========================
      DATABASE_URL: postgresql://geoincra_user:domboscojacutinga33@geoincra_postgres:5432/geoincra_db

      # =========================
      # VOLUME COMPARTILHADO
      # - Worker monta em /data
      # - Backend monta o MESMO volume em /app/app/uploads
      # =========================
      DATA_DIR: /data
      BACKEND_UPLOADS_BASE: /app/app/uploads

      # =========================
      # ONR / SIG-RI ‚Äî CERTIFICADO DIGITAL A1
      # ‚ö†Ô∏è ESTE CAMINHO PRECISA EXISTIR DENTRO DO CONTAINER
      # =========================
      ONR_PFX_PATH: /data/certs/onr_cert.pfx

      # üîê SENHA DO CERTIFICADO A1
      # üëâ A senha REAL que voc√™ digitou no openssl
      ONR_PFX_PASSWORD: "Yeshua33"

    volumes:
      - geoincra_uploads:/data

    networks:
      - backend_default


volumes:
  geoincra_uploads:
    external: true


networks:
  backend_default:
    external: true
